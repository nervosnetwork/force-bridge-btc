.EXPORT_ALL_VARIABLES:
RUST_LOG = info

TOCKB_CLI := ../target/debug/tockb-cli
TOCKB_CLI_LOG := /tmp/tockb-cli.log
WAIT_FOR_COMMITTED := --wait-for-committed
CELL := `cat ${TOCKB_CLI_LOG} | jq .cell_typescript | tr -d '"'`
PRIVATE_KEY := ../tockb-cli/privkeys/0

test-tockb-cli:
	mkdir -p /tmp/.tockb-cli
	#${TOCKB_CLI} init -f
	${TOCKB_CLI} dev-init -f -p 10000 -d 17345997805929 -k ${PRIVATE_KEY}
	${TOCKB_CLI} contract -k ${PRIVATE_KEY} ${WAIT_FOR_COMMITTED} deposit-request -l 1 -k 1 -p 10000 --user-lockscript-addr ckt1qyqvsv5240xeh85wvnau2eky8pwrhh4jr8ts8vyj37 | tee ${TOCKB_CLI_LOG}
	${TOCKB_CLI} contract -k ${PRIVATE_KEY} ${WAIT_FOR_COMMITTED} bonding -c ${CELL} -l bc1qdekmlav7pglh3k2xm6l7s49c8d0lt5cjxgf52j -s ckt1qyqvsv5240xeh85wvnau2eky8pwrhh4jr8ts8vyj37
	${TOCKB_CLI} contract -k ${PRIVATE_KEY} ${WAIT_FOR_COMMITTED} mint-xt -c ${CELL} --spv-proof 900200002c000000300000005e000000a4000000a8000000c8000000d000000024010000880200008c020000020000002a00000001e120d5cc806577ed5d84a9da694f149f19e9229192818285906f4fa4d286ff7a0100000000ffffffff4200000002e0e60b00000000001976a914d51c2f82cef88dcbe6078198b59eaf923369a8dd88ac3d302b27000000001600146e6dbff59e0a3f78d946debfe854b83b5ff5d31200000000f8ea36b3298c05167889ab673d972da05ac001e2303bb4da3fe0d9ba5dae89131d00000000000000500000000000002098c981cb10662d3a815f23e79b24799415ba5d26de000d000000000000000000f3aa3ee9c06ea2e93150c7d7a8e67dea364d3168b617d3d6076ad5226c7073c794a1635f123a1017f1e97f0360010000beba0e94e6866d93db9bb095670dedb65c9b606e3762667447dd1ab134a54c97997d1b9108c23d4c46077ccd28844ca6fe4d60013c0ef1abd7a39b987e5ba5388088b5763da685292cab37dfe7281ceea637ed41a8aaf6d258c39a38fa30e92a5b7f5bb70a4bac9d19b7adf60c796aa677005d481123e6cd7d7b1d79aa9b79663c1b3dc533bc5c771324bda14770688bf81e4ec47f54cb48d8c6b9bf35f429b4fe348f7951390ddab9abf6952bc0deacaae675aecc1e1999666ade2e4ce9b6c1e47bf286f7871390fd3c1b66b3aadead3aa436ac5f4e496ab4b9a811b88580d3ffc09d21b994caf4abb98bb5058b12cbcef124279708a39e4683bc35371f25be14cc4826d97f7853e9612e431071a00ad09d6d219cf96ac7097733b4f8ff6dcaa591dea1579769d7a1d47f34ee1b25975789208745e9dbda47df60cbccbbbf9aa7fcaf28407724c9b06b8ef4cb3080caaf5d664a5fcfce36098c01b45b0b49e10100000000000000
	${TOCKB_CLI} contract -k ${PRIVATE_KEY} ${WAIT_FOR_COMMITTED} pre-term-redeem -c ${CELL} --unlock-address bc1qy90wlm8mujjuud6qs665gjp7hvn67ekef62aer --redeemer-lockscript-addr ckt1qyqvsv5240xeh85wvnau2eky8pwrhh4jr8ts8vyj37
	${TOCKB_CLI} contract -k ${PRIVATE_KEY} ${WAIT_FOR_COMMITTED} withdraw-collateral -c ${CELL} --spv-proof 6d0200002c000000300000005e000000a1000000a5000000c5000000cd000000210100006502000069020000020000002a00000001f8ea36b3298c05167889ab673d972da05ac001e2303bb4da3fe0d9ba5dae89130100000000ffffffff3f00000002d40c0e0000000000160014162cfd632f3f074ef593b6b6b9385865f2286869c3d01c2700000000160014215eefecfbe4a5ce374086b544483ebb27af66d900000000d32513ca22de1945b255a0aa32b0855d077819fbd11dbd9efe86df0cb6eef61b0e000000000000005000000000a0d121d0dc6b9529eeabe4265a308e9c158f3d7358e63fb4b306000000000000000000704040e74e0f3487c3f729861207760fd9715d3add9865fa7b82f04dd70c4a9312a4635f123a101756815c4540010000e6bb50d272ebb52e2993cd5075738f85c459adf6270d8db33e12696e5ad21cf223b47b0b71a9840c413e5cc99f80d3c9e8cc49cbbe5dd4ee505bf03d4187e8d144630fd3eed7cdeccc337a8f93c6347d99bb1f0ce07f66591a58cdad09a572b1267d4713d1b5d491b65d739ab3510fd219f3ce0e9bcf270c760defc24a53729064484b97627510ce6add32f66a2b186a2c712f666b973e7ab06d0a89d6ef156fd95a197b3c6158505d41df27ced3d7de3b70ff220e35964dd3365147a848e2d625776e82be546390e5f402d898fd8673ae4590fe838c924e3d74694afc2196d1e4d0ea99f68f68e926155e4c7168db75864e8cf9024ad1f9731f0eacc76ae0844b447261835b6aa60a0c234e62cd34b71e48e18a4f71dc535fecb0e7c472ac6bbfc869342d6cfa5dd5815152c4ac7f3be44ed11a2542a8a57420a3fc6654f7a80100000000000000

test-using-private:
	mkdir -p /tmp/.tockb-cli
	echo '0xd00c06bfd800d27397002dca6fb0993d5ba6399b4238b2f29ee9deb97593d2bc' > privkeys/user
	echo '0xae45f7c5a4a5e54e8489b92c3d1a943895940694c2bdf1179f848a3a68a70dfe' > privkeys/signer
	#${TOCKB_CLI} init -f
	#${TOCKB_CLI} dev-init -f -p 10000 -d 0 -k privkeys/user
	${TOCKB_CLI} contract -k privkeys/user ${WAIT_FOR_COMMITTED} deposit-request -l 1 -k 1 -p 10000 --user-lockscript-addr ckt1qyqvsv5240xeh85wvnau2eky8pwrhh4jr8ts8vyj37 | tee ${TOCKB_CLI_LOG}
	${TOCKB_CLI} contract -k privkeys/signer ${WAIT_FOR_COMMITTED} bonding -c ${CELL} -l bcrt1qfzdcp53u29yt9u5u3d0sx3u2f5xav7sqatfxm2 -s ckt1qyqy98f68w7sf0gu45d07thjuhynk4r59jqsqntpzu
	${TOCKB_CLI} contract -k privkeys/user ${WAIT_FOR_COMMITTED} mint-xt -c ${CELL} --spv-proof 2e0100002c000000300000005e0000008200000086000000a6000000ae00000002010000260100002a010000010000002a00000001ce89cb795d1b1c9c942e6d0192c73793d5332a284e5135c5bf99b0f303303caa0000000000000000002000000001e0f57f4a00000000160014489b80d23c5148b2f29c8b5f03478a4d0dd67a00000000006fca52ac1b8f18dc7c9747687702fe518e307c940ee432653651757149596769010000000000000050000000000000204bbb22fd5881cecbc6a62463a782261cbfd897974a0b8d5ac57090c6965609032c93a31ba3c9669ef97b19e0a7161c7a47c30505a661894648f0534644f0b016b9e3725fffff7f200000000020000000df91a540455e5b8c6586793e1d52928047f2b07bc19af072e4cde94ec82010020000000000000000
	${TOCKB_CLI} contract -k privkeys/user ${WAIT_FOR_COMMITTED} pre-term-redeem -c ${CELL} --unlock-address bcrt1q4r9hqljdpfwxu6gp3x7qqedg77r6408dn4wmnf --redeemer-lockscript-addr ckt1qyqvsv5240xeh85wvnau2eky8pwrhh4jr8ts8vyj37
	${TOCKB_CLI} contract -k privkeys/signer ${WAIT_FOR_COMMITTED} withdraw-collateral -c ${CELL} --spv-proof 2e0100002c000000300000005e0000008200000086000000a6000000ae00000002010000260100002a010000010000002a000000016fca52ac1b8f18dc7c9747687702fe518e307c940ee4326536517571495967690000000000000000002000000001406f7e4a00000000160014a8cb707e4d0a5c6e690189bc0065a8f787aabced00000000ab77c28aa299db4e6ea4cde2bfc443edeff0d2e8c787c8565e7396cfea1afb41010000000000000050000000000000203fdffd0b7a43f03f911c51dbaa81a7e01ee2fa2bc9e39eac812d173ca756b73370aefd54923a05abb8bf26c874eb7f8801dae5d34d569d45398376294e1f8457effa725fffff7f2000000000200000003d55cf41d9ee293736caff3210215d3c60ba0b22569609971067248eac82279b0000000000000000

server:
	mkdir -p /tmp/.tockb-cli
	${TOCKB_CLI} dev-init -f -p 10000 -d 17345997805929 -k ${PRIVATE_KEY}
	${TOCKB_CLI} server